<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MidRock Coin Web App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: url('https://upload.wikimedia.org/wikipedia/commons/2/2e/Flag_of_Pakistan.svg') no-repeat center center fixed;
      background-size: cover;
      color: #333;
    }
    header {
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
    }
    main {
      max-width: 800px;
      margin: 2rem auto;
      background: rgba(255,255,255,0.9);
      padding: 2rem;
      border-radius: 10px;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      font-size: 1rem;
    }
    .hidden { display: none; }
    .user-section, .admin-section { margin-top: 2rem; }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>
    بسم اللہ الرحمن الرحیم - MidRock Coin Web App
  </header>
  <main>
    <div id="auth-section">
      <h2>Sign Up / Login</h2>
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Password (6+ chars)" />
      <button id="signup-btn">Sign Up</button>
      <button id="login-btn">Login</button>
      <p id="auth-msg"></p>
    </div>

    <div id="user-section" class="hidden user-section">
      <h2>User Dashboard</h2>
      <p id="welcome-user"></p>
      <p>Coin Balance: <span id="coin-balance">0</span></p>
      <button id="claim-coin-btn">Claim Coin (Weekly)</button>
      <button id="watch-ad-btn">Watch Ad for 1-100 Points</button>
      <button id="referral-btn">Referral (+1 Coin)</button>
      <button id="swap-coin-btn">Swap Coin to PKR</button>
    </div>

    <div id="admin-section" class="hidden admin-section">
      <h2>Admin Dashboard</h2>
      <p id="welcome-admin"></p>
      <button id="view-users-btn">View Users</button>
      <button id="approve-kyc-btn">Approve KYC</button>
      <button id="manual-withdraw-btn">Manual Withdraw</button>
      <p>Total Users: <span id="total-users">0</span></p>
      <p>Total Coins: <span id="total-coins">0</span></p>
    </div>
  </main>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyB5eo1y81OryaZ-suV_FMpe04_edMIa6Hk",
      authDomain: "mid-rock-coin.firebaseapp.com",
      projectId: "mid-rock-coin",
      storageBucket: "mid-rock-coin.firebasestorage.app",
      messagingSenderId: "911725035840",
      appId: "1:911725035840:web:fe14626d187c11ecb83aa5",
      measurementId: "G-YGPCZ8ZR49"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Elements
    const signupBtn = document.getElementById('signup-btn');
    const loginBtn = document.getElementById('login-btn');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const authMsg = document.getElementById('auth-msg');

    const userSection = document.getElementById('user-section');
    const adminSection = document.getElementById('admin-section');
    const welcomeUser = document.getElementById('welcome-user');
    const welcomeAdmin = document.getElementById('welcome-admin');
    const coinBalanceEl = document.getElementById('coin-balance');

    // Roles (sample, replace with real logic)
    const CEO_EMAIL = "hasnainjadoon5005@gmail.com";
    const MD_EMAIL = "hasnainjadoon6006@gmail.com";

    let currentUserRole = "user"; // default

    // Sign Up
    signupBtn.addEventListener('click', () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      auth.createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        authMsg.textContent = "User Registered!";
        const user = userCredential.user;
        let role = "user";
        if(email === CEO_EMAIL) role = "admin";
        if(email === MD_EMAIL) role = "admin";
        currentUserRole = role;
        db.collection('users').doc(user.uid).set({email, role, coins: 0, kycApproved: false});
        showDashboard();
      })
      .catch(err => { authMsg.textContent = err.message; });
    });

    // Login
    loginBtn.addEventListener('click', () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      auth.signInWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        db.collection('users').doc(user.uid).get().then(doc => {
          if(doc.exists) {
            currentUserRole = doc.data().role;
            showDashboard();
          }
        });
      })
      .catch(err => { authMsg.textContent = err.message; });
    });

    function showDashboard() {
      document.getElementById('auth-section').classList.add('hidden');
      if(currentUserRole === "user") {
        userSection.classList.remove('hidden');
        auth.currentUser && (welcomeUser.textContent = `Welcome ${auth.currentUser.email}`);
        loadUserCoins();
      } else {
        adminSection.classList.remove('hidden');
        auth.currentUser && (welcomeAdmin.textContent = `Welcome Admin ${auth.currentUser.email}`);
        loadAdminStats();
      }
    }

    function loadUserCoins() {
      const uid = auth.currentUser.uid;
      db.collection('users').doc(uid).onSnapshot(doc => {
        if(doc.exists) {
          coinBalanceEl.textContent = doc.data().coins;
        }
      });
    }

    function loadAdminStats() {
      db.collection('users').onSnapshot(snapshot => {
        let totalUsers = snapshot.size;
        let totalCoins = 0;
        snapshot.forEach(doc => { totalCoins += doc.data().coins; });
        document.getElementById('total-users').textContent = totalUsers;
        document.getElementById('total-coins').textContent = totalCoins;
      });
    }

    // User Actions
    document.getElementById('claim-coin-btn').addEventListener('click', () => {
      const uid = auth.currentUser.uid;
      db.collection('users').doc(uid).get().then(doc => {
        if(doc.exists) {
          let coins = doc.data().coins || 0;
          coins += 1; // weekly claim
          db.collection('users').doc(uid).update({coins});
        }
      });
    });

    document.getElementById('watch-ad-btn').addEventListener('click', () => {
      const points = Math.floor(Math.random()*100)+1;
      const uid = auth.currentUser.uid;
      db.collection('users').doc(uid).get().then(doc => {
        if(doc.exists) {
          let coins = doc.data().coins || 0;
          coins += points / 500; // 1000 points = 2 coins
          db.collection('users').doc(uid).update({coins});
        }
      });
    });

    document.getElementById('referral-btn').addEventListener('click', () => {
      const uid = auth.currentUser.uid;
      db.collection('users').doc(uid).get().then(doc => {
        if(doc.exists) {
          let coins = doc.data().coins || 0;
          coins += 1; // referral coin
          db.collection('users').doc(uid).update({coins});
        }
      });
    });

    document.getElementById('swap-coin-btn').addEventListener('click', () => {
      const uid = auth.currentUser.uid;
      db.collection('users').doc(uid).get().then(doc => {
        if(doc.exists && doc.data().kycApproved) {
          let coins = doc.data().coins || 0;
          let pkr = coins * 1; // 1 coin = 1 PKR
          alert(`Coins converted: ${coins} → PKR ${pkr}`);
          db.collection
